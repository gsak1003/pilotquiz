<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>퀴즈 결과</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .container { background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); width: 100%; max-width: 700px; text-align: center; }
        h1 { margin-top: 0; font-size: 28px; }
        .score-header { font-size: 32px; font-weight: bold; color: #1877f2; margin-bottom: 20px; }
        .analysis-section { background-color: #f9f9f9; border-radius: 6px; padding: 20px; margin-top: 30px; text-align: left; }
        .analysis-section h3 { margin-top: 0; }
        .results-list { list-style: none; padding: 0; text-align: left; margin-top: 30px;}
        .results-list li { border: 1px solid #dddfe2; border-radius: 6px; padding: 15px; margin-bottom: 10px; }
        .results-list .question { font-weight: bold; }
        .results-list .user-answer { color: #606770; }
        .results-list .correct { color: #42b72a; }
        .results-list .incorrect { color: #fa3e3e; }
        .results-list .explanation { font-size: 14px; color: #333; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; }
        .btn-home { display: inline-block; padding: 12px 25px; background-color: #1877f2; border-radius: 6px; color: white; text-decoration: none; font-weight: bold; margin-top: 30px;}

        @media (max-width: 768px) {
            body { padding-top: 20px; }
            .container { padding: 20px; }
            h1 { font-size: 22px; }
            .score-header { font-size: 26px; }
            .results-list .question { font-size: 15px; }
            .results-list .user-answer, .results-list .correct-answer { font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>퀴즈 결과</h1>
        <h2 id="score-header" class="score-header"></h2>
        <div id="results-list" class="results-list"></div>
        <div id="analysis-section" class="analysis-section" style="display: none;">
            <h3>학습 분석</h3>
            <p id="analysis-text"></p>
        </div>
        <a href="dashboard.html" class="btn-home">대시보드로 돌아가기</a>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultsData = JSON.parse(sessionStorage.getItem('quizResults'));
            if (resultsData) {
                document.getElementById('score-header').textContent = `${resultsData.score} / ${resultsData.total} 개 정답!`;
                const resultsList = document.getElementById('results-list');
                const questionsData = JSON.parse(sessionStorage.getItem('quizQuestions'));
                resultsData.results.forEach(result => {
                    const questionInfo = questionsData.find(q => q.id === result.questionId);
                    const li = document.createElement('li');
                    const correctIndicator = result.isCorrect ? '<span class="correct">(정답)</span>' : '<span class="incorrect">(오답)</span>';
                    li.innerHTML = `
                        <p class="question">${questionInfo.id}번. ${questionInfo.question}</p>
                        <p class="user-answer">나의 답: ${result.userAnswer} ${correctIndicator}</p>
                        ${!result.isCorrect ? `<p class="correct-answer">정답: ${result.correctAnswer}</p>` : ''}
                        <p class="explanation"><strong>해설:</strong> ${questionInfo.explanation}</p>
                    `;
                    resultsList.appendChild(li);
                });
                const analysisSection = document.getElementById('analysis-section');
                const analysisText = document.getElementById('analysis-text');
                let analysisReport = '';
                if (resultsData.analysis) {
                    for (const topic in resultsData.analysis) {
                        const stats = resultsData.analysis[topic];
                        const accuracy = (stats.correct / stats.total) * 100;
                        analysisReport += `<p><strong>${topic}:</strong> ${stats.correct} / ${stats.total} (정답률: ${accuracy.toFixed(0)}%)</p>`;
                        if (accuracy < 70) {
                            analysisReport += `<p style="color: #fa3e3e;">'${topic}' 파트에 대한 추가 학습이 필요합니다.</p>`;
                        }
                    }
                    if(analysisReport) {
                        analysisText.innerHTML = analysisReport;
                        analysisSection.style.display = 'block';
                    }
                }
            } else {
                document.getElementById('score-header').textContent = '결과 데이터를 불러올 수 없습니다.';
            }
            sessionStorage.removeItem('quizResults');
            sessionStorage.removeItem('quizQuestions');
        });
    </script>
</body>
</html>